#! /usr/bin/env bash

set -euo pipefail

USAGE='[-h] [diff-opts]

Show the plus/minus stats'
SUBDIRECTORY_OK=true

# source git-sh-setup for some helpers
set +u
source "$(git --exec-path)"/git-sh-setup
set -u

log() {
  printf '%s\n' "$@"
} >&2

count_lines () {
  local pat="$1"
  shift
  local changed_count
  changed_count="$(git diff "$@" --name-only | wc -l)"
  git diff "$@" | grep -ce "$pat" | dc -f - -e "$changed_count - p"
}

main() {
  printf -- '+ %d\n' "$(count_lines ^+ "$@")"
  printf -- '- %d\n' "$(count_lines ^- "$@")"
}

main "$@"
